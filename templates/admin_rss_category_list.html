{% extends "admin_base.html" %}
{% block title %}RSS Feed by Categories{% endblock %}

{% block content %}
<div class="container py-5">
  <h1 class="fw-bold mb-4 text-primary">RSS Feed by Categories</h1>

  <!-- Domain Selection Card -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-body">
      <form method="GET" class="d-flex flex-wrap align-items-center gap-3">
        <label for="domain-select" class="form-label fw-semibold mb-0">Select Domain:</label>
        <select name="selected_domain_id" id="domain-select" class="form-select w-100" onchange="this.form.submit()">
          <option value="">-- Choose Domain --</option>
          {% for key, domain in domain_configs.items() %}
            <option value="{{ key }}" {% if key == selected_domain_id %}selected{% endif %}>
               {{ domain.host or 'No Host' }}
            </option>
          {% endfor %}
        </select>
        <noscript><button type="submit" class="btn btn-primary">Go</button></noscript>
      </form>
    </div>
  </div>

  {% if selected_domain_label %}
    <div class="alert alert-info rounded-3 shadow-sm">
      Showing categories with posts from domain:
      <strong class="text-dark">{{ selected_domain_label }}</strong>
    </div>
  {% endif %}

  {% if categories %}
    <div class="card shadow-sm border-0 rounded-4">
      <div class="card-body p-0">
        <ul class="list-group list-group-flush">
          {% for cat in categories %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span class="fw-semibold text-dark">{{ cat.name }}</span>
              <a target="_blank" href="{{ url_for('rss_feed_by_domain_and_category', host=selected_domain_host, category_id=cat.id) }}">
                <i class="bi bi-rss-fill me-1"></i> View RSS
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% else %}
    <div class="alert alert-warning mt-4 rounded-3 shadow-sm">
      No categories found for this domain.
    </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- jQuery (required by Select2) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <script>
    $(document).ready(function() {
      $('#domain-select').select2({
        placeholder: "-- Choose Domain --",
        allowClear: true,
        width: 'resolve'
      });
    });
  </script>
{% endblock %}
